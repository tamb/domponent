!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Domponent={})}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function o(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p={component:"component",key:"key",props:"props",action:"action",state:"state",bind:"bind",ref:"ref",ref_array:"ref-array"},l={INHERITS_FROM:"<-",FROM_COMPONENT:".",KEY_VALUE:":",MULTIPLE_VALUES:"|",METHOD_CALL:"->",LIST:","},h={ONCE:"once",PASSIVE:"passive",CAPTURE:"capture"},f=function t(n){e(this,t),this.$root=n.element,this.$app=n.app,this.$key=n.key,this.$name=n.element.getAttribute("data-".concat(this.$app.$datasets.component))};function d(t,e){t.textContent=e}function m(t){t&&t()}function v(t){return t.trim().split(l.KEY_VALUE).map(function(t){return t.trim()})}function y(t){return t.trim().split(l.MULTIPLE_VALUES).map(function(t){return t.trim()})}function g(t){return t.includes(".")||console.error('🤓 -- "You have bad syntax on this data- value: '.concat(t,".  \n    You need to have a period (.) like 'MyComponent.myField'")),t.trim().split(l.FROM_COMPONENT).map(function(t){return t.trim()})}function $(){var t=this;this.$b=[],(this.$root.getAttribute("data-".concat(this.$app.$datasets.action))?[this.$root]:[]).concat(E.call(this,"[data-".concat(this.$app.$datasets.action,"]"))).forEach(function(e){var n=y(e.getAttribute("data-".concat(t.$app.$datasets.action))),o={el:e,actions:[]};n.forEach(function(n){var r,a=((r=n).includes("->")||console.error('🤓 -- "You have bad syntax on this data- value: '.concat(r,".  \n      You are missing an arrow in your method call.  It should look like this 'DOMEvent->MyComponent.myMethod'")),r.trim().split(l.METHOD_CALL).map(function(t){return t.trim()})),i=a[0],s=g(a[1]);if(s[0]===t.$name){var c={};if(s[2]){var u=function(t){return t.trim().split(l.LIST).map(function(t){return t.trim()})}(s[2]);for(var p in h)c[h[p]]=u.includes(h[p])}var f=t[s[1]].bind(t);e.addEventListener(i,f,c),o.actions.push({event:i,handler:f,options:c})}},t),t.$b.push(o)},this)}function b(t){var e=this;try{this.$d.forEach(function(n){(function(t){var e=this;this.propsWillUpdate();var n=Object.assign({},this.props),o=function(n){var o=e.$p[n];t.includes(e.$p[n].parentComponentKey)&&(e.props[n]=o.parentComponent.state[o.parentComponentKey],e.$p[n].els&&e.$p[n].els.forEach(function(t){updateDOM(t,e.props[n])}))};for(var r in this.$p)o(r);this.propsDidUpdate(n)}).call(e.$app.registeredComponents[n],t)})}catch(t){console.error('🤓 -- "You had this issue:\n    '.concat(t," \n    updating the dependents of this component: \n    ").concat(this,'...\n    Can I DEPEND on your for a ride to the airport?... Friend??"'))}}function x(){var t=this,e=this.$root.getAttribute("data-".concat(this.$app.$datasets.props));if(e){var n={};return y(e).forEach(function(e){var o,r=((o=e).includes("<-")||console.error('🤓 -- "You have bad syntax on this data- value: '.concat(o,".  \n        You are not inheriting props correctly.  It should look like this 'myProp<-MyComponent.myStateField'")),o.trim().split(l.INHERITS_FROM).map(function(t){return t.trim()})),a=v(r[1]),i=r[0],s=t.$app.registeredComponents[a[0]],c=a[1];s.$d.add(t.$key);var p=u(E.call(t,"[".concat(t.$app.$datasets.bind,'^="props:').concat(i,'"]')));t.props[i]=s.state[c],n[i]={parentComponent:s,parentComponentKey:c,els:p.length>0?p:null}},this),n}return null}function E(t){var e=this;return u(this.$root.querySelectorAll(t)).filter(function(t){return t.closest("[data-".concat(e.$app.$datasets.component,'="').concat(e.$root.getAttribute("data-"+e.$app.$datasets.component),'"]'))===e.$root})}var C=function(t){function n(t){var o,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(this,n),(o=c(this,a(n).call(this,t))).connecting(),o.props={},o.$d=new Set,function(){var t=this;E.call(this,"[data-".concat(this.$app.$datasets.ref,"*='").concat(this.$name,".']")).forEach(function(e){t[g(e.getAttribute("data-".concat(t.$app.$datasets.ref)))[1]]=e})}.call(s(o)),function(){var t=this,e=null;E.call(this,"[data-".concat(this.$app.$datasets.ref_array,"*='").concat(this.$name,".']")).forEach(function(n){var o=g(n.getAttribute("data-".concat(t.$app.$datasets.ref_array)))[1];o===e?t[o].push(n):(e=o,t[o]=[],t[o].push(n))})}.call(s(o)),o.$p=x.call(s(o)),$.call(s(o)),!r&&o.connected(),o}return r(n,f),o(n,[{key:"connecting",value:function(){}},{key:"connected",value:function(){}},{key:"disconnecting",value:function(){}},{key:"propsWillUpdate",value:function(){}},{key:"propsDidUpdate",value:function(){}}]),n}(),_=function(t){function n(t){var o;return e(this,n),o=c(this,a(n).call(this,t,!0)),function(){var t=this.$root.getAttribute("data-".concat(this.$app.$datasets.state));this.state=t?JSON.parse(t):{}}.call(s(o)),o.$s=function(){var t=this,e=E.call(this,"[data-".concat(this.$app.$datasets.bind,'^="state:"]'));if(e.length>0){var n={};return e.forEach(function(e){var o={};try{var r=y(e.getAttribute("data-".concat(t.$app.$datasets.bind)))}catch(t){console.error("🤓 -- \"There's a problem creating the state.\n        You have a syntax error splitting multiple values on element: \n        ".concat(e," with error: ").concat(t,'"'))}r.forEach(function(t){try{var r=v(t)}catch(t){console.error("🤓 -- \"There's a problem creating the state.\n          You have a syntax error splitting key/value pairs on element: \n          ".concat(e," with error: ").concat(t,'"'))}try{var a=g(r[1])[1]}catch(t){console.error("🤓 -- \"There's a problem creating the state.\n          You have a syntax error splitting fields from components on element: \n          ".concat(e," with error: ").concat(t,'"'))}o.el=e,n[a]||(n[a]=[]),n[a].push(o)})},this),n}return 0===e.length&&console.warn('🤓 -- "You are creating state but not binding state values to any DOM elements.  Is this intended? \n    If not, check your binding syntax from within this root element ',this.$root),null}.call(s(o)),o.connected(),o}return r(n,C),o(n,[{key:"stateWillUpdate",value:function(){}},{key:"stateDidUpdate",value:function(){}},{key:"setState",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,n=arguments.length>1?arguments[1]:void 0;this.stateWillUpdate();var o=[];try{var r=function(n){e[n]!==t.state[n]&&(o.push(n),t.state[n]=e[n],t.$s&&t.$s[n]&&t.$s[n].forEach(function(t){d(t.el,e[n])}))};for(var a in e)r(a)}catch(t){console.error('🤓 -- "Whoops, pal!  You ran into this error while updating state: \n      ',t," within this root element ",this.$root)}this.$d.size>0&&b.call(this,o),m(n),this.stateDidUpdate()}}]),n}();console.warn('🤓 -- "Excuse me there. I am Dominic, call me Dom.\nYou are using a DEVELOPMENT build of Domponent.  \nThis will create performance issues within your app.  \nThe use of domponent.development.js is to provide better debugging... and to hang with me... Dom.\nPlease swap out to domponent.production.min.js for production code.\nSee ya soon!"'),t.Component=_,t.Exponent=C,t.Init=function(t){var e=this;return this.components=t.components||{},this.registeredComponents={},this.$datasets=function(){var e=p;if(t.dataAttributes)for(var n in t.dataAttributes)e[n]=t.dataAttributes[n];return console.log('🤓 -- "Dom here. Your data attribute suffixes are in this object: \n      ',e,'\n      Coolio.  We should hang out some time!"'),e}(),this._cc=function(n,o){var r=n.getAttribute("data-".concat(e.$datasets.key))||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});try{e.registeredComponents[r]=new(t.components[n.getAttribute("data-".concat(e.$datasets.component))])({element:n,key:r,app:e})}catch(t){console.error('🤓 -- "You messed up creating a component instance for component \n          '.concat(r,' \n          on $root element "'),n,t)}o&&o()},this._dc=function(t,n){e.registeredComponents[t].disconnecting(),function(){var t=this;try{this.$b.forEach(function(e){e.actions.forEach(function(t){e.el.removeEventListener(t.event,t.handler,t.options)},t)},this)}catch(t){console.error('🤓 -- "You had this issue:\n  '.concat(t,"\n  removing eventListeners while deleting this component:  \n  ").concat(this,"\n  ... You'll still listen to me though? Right?? I love our chats."))}}.call(e.registeredComponents[t]),delete e.registeredComponents[t],n&&n()},this._rc=function(t,n,o){"function"!=typeof n.constructor&&console.error("🤓 -- \"Hey, buddy.  You can't register something that's not a class.\n        Also, wanna play Catan or something later?  ...No pressure.\""),e.components[t]=n,o&&o()},this._urc=function(t,n){delete e.component[t],n&&n()},u(t.selector.querySelectorAll("[data-".concat(this.$datasets.component,"]"))).forEach(function(t){e._cc(t)},this),t.appCreated&&t.appCreated(),console.log('🤓 -- "Here\'s the app you created: "',this),{createComponent:function(t,n){return e._cc(t,n)},deleteComponent:function(t,n){return e._dc(t,n)},register:function(t,n,o){return e._rc(t,n,o)},unregister:function(t,n){return e._urc(t,n)},createdComponents:this.registeredComponents,components:this.components}},Object.defineProperty(t,"__esModule",{value:!0})});
