!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).Domponent={})}(this,function(t){"use strict";function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function e(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function a(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}function r(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&i(t,n)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,n){return!n||"object"!=typeof n&&"function"!=typeof n?c(t):n}function p(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u={component:"component",key:"key",props:"props",action:"action",state:"state",bind:"bind",ref:"ref",ref_array:"ref-array"},l={INHERITS_FROM:"<-",FROM_COMPONENT:".",KEY_VALUE:":",MULTIPLE_VALUES:"|",METHOD_CALL:"->",LIST:","},f={ONCE:"once",PASSIVE:"passive",CAPTURE:"capture"},h=function t(e){n(this,t),this.$root=e.element,this.$app=e.app,this.$key=e.key,this.$name=e.element.getAttribute("data-".concat(this.$app.$datasets.component))};function d(t,n){t.textContent=n}function $(t){t&&t()}function y(t){return t.trim().split(this.$app.$syntax.KEY_VALUE).map(function(t){return t.trim()})}function m(t){return t.trim().split(this.$app.$syntax.MULTIPLE_VALUES).map(function(t){return t.trim()})}function v(t){return t.includes("."),t.trim().split(this.$app.$syntax.FROM_COMPONENT).map(function(t){return t.trim()})}function x(t){var n=this;try{this.$d.forEach(function(e){(function(t){var n=this;this.propsWillUpdate();var e=Object.assign({},this.props),a=function(e){var a=n.$p[e];t.includes(n.$p[e].parentComponentKey)&&(n.props[e]=a.parentComponent.state[a.parentComponentKey],n.$p[e].els&&n.$p[e].els.forEach(function(t){updateDOM(t,n.props[e])}))};for(var r in this.$p)a(r);this.propsDidUpdate(e)}).call(n.$app.registeredComponents[e],t)})}catch(t){}}function b(t){var n=this;return p(this.$root.querySelectorAll(t)).filter(function(t){return t.closest("[data-".concat(n.$app.$datasets.component,'="').concat(n.$root.getAttribute("data-"+n.$app.$datasets.component),'"]'))===n.$root})}var g=function(t){function e(t){var a,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(this,e),(a=s(this,o(e).call(this,t))).connecting(),a.props={},a.$d=new Set,function(){var t=this,n=this;b.call(this,"[data-".concat(this.$app.$datasets.ref,"*='").concat(this.$name).concat(this.$app.$syntax.FROM_COMPONENT,"']")).forEach(function(e){t[v.call(n,e.getAttribute("data-".concat(t.$app.$datasets.ref)))[1]]=e})}.call(c(a)),function(){var t=this,n=null,e=this;b.call(this,"[data-".concat(this.$app.$datasets.ref_array,"*='").concat(this.$name).concat(this.$app.$syntax.FROM_COMPONENT,"']")).forEach(function(a){var r=v.call(e,a.getAttribute("data-".concat(t.$app.$datasets.ref_array)))[1];r===n?t[r].push(a):(n=r,t[r]=[],t[r].push(a))})}.call(c(a)),a.$p=function(){var t=this,n=this,e=this.$root.getAttribute("data-".concat(this.$app.$datasets.props));if(e){var a={};return m.call(n,e).forEach(function(e){var r=function(t){return t.includes("<-"),t.trim().split(this.$app.$syntax.INHERITS_FROM).map(function(t){return t.trim()})}.call(n,e),o=y.call(n,r[1]),i=r[0],c=t.$app.registeredComponents[o[0]],s=o[1];c.$d.add(t.$key);var u=p(b.call(t,"[".concat(t.$app.$datasets.bind,'^="props').concat(t.$app.$syntax.KEY_VALUE).concat(i,'"]')));t.props[i]=c.state[s],a[i]={parentComponent:c,parentComponentKey:s,els:u.length>0?u:null}},this),a}return null}.call(c(a)),function(){var t=this,n=this;this.$b=[],(this.$root.getAttribute("data-".concat(this.$app.$datasets.action))?[this.$root]:[]).concat(b.call(this,"[data-".concat(this.$app.$datasets.action,"]"))).forEach(function(e){var a=m.call(n,e.getAttribute("data-".concat(t.$app.$datasets.action))),r={el:e,actions:[]};a.forEach(function(a){var o=function(t){return t.includes("->"),t.trim().split(this.$app.$syntax.METHOD_CALL).map(function(t){return t.trim()})}.call(n,a),i=o[0],c=v.call(n,o[1]);if(c[0]===t.$name){var s={};if(c[2]){var p=function(t){return t.trim().split(this.$app.$syntax.LIST).map(function(t){return t.trim()})}.call(n,c[2]);for(var u in f)s[f[u]]=p.includes(f[u])}var l=t[c[1]].bind(t);e.addEventListener(i,l,s),r.actions.push({event:i,handler:l,options:s})}},t),t.$b.push(r)},this)}.call(c(a)),!r&&a.connected(),a}return r(e,h),a(e,[{key:"connecting",value:function(){}},{key:"connected",value:function(){}},{key:"disconnecting",value:function(){}},{key:"propsWillUpdate",value:function(){}},{key:"propsDidUpdate",value:function(){}}]),e}(),E=function(t){function e(t){var a;return n(this,e),a=s(this,o(e).call(this,t,!0)),function(){var t=this.$root.getAttribute("data-".concat(this.$app.$datasets.state));this.state=t?JSON.parse(t):{}}.call(c(a)),a.$s=function(){var t=this,n=this,e=b.call(this,"[data-".concat(this.$app.$datasets.bind,'^="state').concat(this.$app.$syntax.KEY_VALUE,'"]'));if(e.length>0){var a={};return e.forEach(function(e){var r={};try{var o=m.call(n,e.getAttribute("data-".concat(t.$app.$datasets.bind)))}catch(t){}o.forEach(function(t){try{var o=y.call(n,t)}catch(t){}try{var i=v.call(n,o[1])[1]}catch(t){}r.el=e,a[i]||(a[i]=[]),a[i].push(r)})},this),a}return e.length,null}.call(c(a)),a.connected(),a}return r(e,g),a(e,[{key:"stateWillUpdate",value:function(){}},{key:"stateDidUpdate",value:function(){}},{key:"setState",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,e=arguments.length>1?arguments[1]:void 0;this.stateWillUpdate();var a=[];try{var r=function(e){n[e]!==t.state[e]&&(a.push(e),t.state[e]=n[e],t.$s&&t.$s[e]&&t.$s[e].forEach(function(t){d(t.el,n[e])}))};for(var o in n)r(o)}catch(t){}this.$d.size>0&&x.call(this,a),$(e),this.stateDidUpdate()}}]),e}();t.Component=E,t.Exponent=g,t.Init=function(t){var n=this;return this.components=t.components||{},this.registeredComponents={},this.$datasets=function(){var n=u;if(t.dataAttributes)for(var e in t.dataAttributes)n[e]=t.dataAttributes[e];return n}(),this.$syntax=function(){var n=l;if(t.customSyntax)for(var e in t.customSyntax)n[e]=t.customSyntax[e];return n}(),this._cc=function(e,a){var r=e.getAttribute("data-".concat(n.$datasets.key))||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)});try{n.registeredComponents[r]=new(t.components[e.getAttribute("data-".concat(n.$datasets.component))])({element:e,key:r,app:n})}catch(t){}a&&a()},this._dc=function(t,e){n.registeredComponents[t].disconnecting(),function(){var t=this;try{this.$b.forEach(function(n){n.actions.forEach(function(t){n.el.removeEventListener(t.event,t.handler,t.options)},t)},this)}catch(t){}}.call(n.registeredComponents[t]),delete n.registeredComponents[t],e&&e()},this._rc=function(t,e,a){e.constructor,n.components[t]=e,a&&a()},this._urc=function(t,e){delete n.component[t],e&&e()},p(t.selector.querySelectorAll("[data-".concat(this.$datasets.component,"]"))).forEach(function(t){n._cc(t)},this),t.appCreated&&t.appCreated(),{createComponent:function(t,e){return n._cc(t,e)},deleteComponent:function(t,e){return n._dc(t,e)},register:function(t,e,a){return n._rc(t,e,a)},unregister:function(t,e){return n._urc(t,e)},createdComponents:this.registeredComponents,components:this.components}},Object.defineProperty(t,"__esModule",{value:!0})});
