!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).Domponent={})}(this,function(t){"use strict";function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function e(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&i(t,n)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,n){return!n||"object"!=typeof n&&"function"!=typeof n?c(t):n}function u(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p={component:"component",key:"key",props:"props",action:"action",state:"state",bind:"bind",ref:"ref",ref_array:"ref-array"},f={INHERITS_FROM:"<-",FROM_COMPONENT:".",KEY_VALUE:":",MULTIPLE_VALUES:"|",METHOD_CALL:"->",LIST:","},l={ONCE:"once",PASSIVE:"passive",CAPTURE:"capture"},h=function t(e){n(this,t),this.$root=e.element,this.$app=e.app,this.$key=e.key,this.$name=e.element.getAttribute("data-".concat(this.$app.$datasets.component))};function d(t,n){t.textContent=n}function v(t){t&&t()}function $(t){return t.trim().split(f.KEY_VALUE).map(function(t){return t.trim()})}function m(t){return t.trim().split(f.MULTIPLE_VALUES).map(function(t){return t.trim()})}function y(t){return t.includes("."),t.trim().split(f.FROM_COMPONENT).map(function(t){return t.trim()})}function b(){var t=this;this.$b=[],(this.$root.getAttribute("data-".concat(this.$app.$datasets.action))?[this.$root]:[]).concat(E.call(this,"[data-".concat(this.$app.$datasets.action,"]"))).forEach(function(n){var e=m(n.getAttribute("data-".concat(t.$app.$datasets.action))),r={el:n,actions:[]};e.forEach(function(e){var a,o=((a=e).includes("->"),a.trim().split(f.METHOD_CALL).map(function(t){return t.trim()})),i=o[0],c=y(o[1]);if(c[0]===t.$name){var s={};if(c[2]){var u=function(t){return t.trim().split(f.LIST).map(function(t){return t.trim()})}(c[2]);for(var p in l)s[l[p]]=u.includes(l[p])}var h=t[c[1]].bind(t);n.addEventListener(i,h,s),r.actions.push({event:i,handler:h,options:s})}},t),t.$b.push(r)},this)}function g(t){var n=this;try{this.$d.forEach(function(e){(function(t){var n=this;this.propsWillUpdate();var e=Object.assign({},this.props),r=function(e){var r=n.$p[e];t.includes(n.$p[e].parentComponentKey)&&(n.props[e]=r.parentComponent.state[r.parentComponentKey],n.$p[e].els&&n.$p[e].els.forEach(function(t){updateDOM(t,n.props[e])}))};for(var a in this.$p)r(a);this.propsDidUpdate(e)}).call(n.$app.registeredComponents[e],t)})}catch(t){}}function x(){var t=this,n=this.$root.getAttribute("data-".concat(this.$app.$datasets.props));if(n){var e={};return m(n).forEach(function(n){var r,a=((r=n).includes("<-"),r.trim().split(f.INHERITS_FROM).map(function(t){return t.trim()})),o=$(a[1]),i=a[0],c=t.$app.registeredComponents[o[0]],s=o[1];c.$d.add(t.$key);var p=u(E.call(t,"[".concat(t.$app.$datasets.bind,'^="props:').concat(i,'"]')));t.props[i]=c.state[s],e[i]={parentComponent:c,parentComponentKey:s,els:p.length>0?p:null}},this),e}return null}function E(t){var n=this;return u(this.$root.querySelectorAll(t)).filter(function(t){return t.closest("[data-".concat(n.$app.$datasets.component,'="').concat(n.$root.getAttribute("data-"+n.$app.$datasets.component),'"]'))===n.$root})}var _=function(t){function e(t){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(this,e),(r=s(this,o(e).call(this,t))).connecting(),r.props={},r.$d=new Set,function(){var t=this;E.call(this,"[data-".concat(this.$app.$datasets.ref,"]")).forEach(function(n){t[y(n.getAttribute("data-".concat(t.$app.$datasets.ref)))[1]]=n})}.call(c(r)),function(){var t=this,n=null;E.call(this,"[data-".concat(this.$app.$datasets.ref_array,"]")).forEach(function(e){var r=y(e.getAttribute("data-".concat(t.$app.$datasets.ref_array)))[1];r===n?t[r].push(e):(n=r,t[r]=[],t[r].push(e))})}.call(c(r)),r.$p=x.call(c(r)),b.call(c(r)),!a&&r.connected(),r}return a(e,h),r(e,[{key:"connecting",value:function(){}},{key:"connected",value:function(){}},{key:"disconnecting",value:function(){}},{key:"propsWillUpdate",value:function(){}},{key:"propsDidUpdate",value:function(){}}]),e}(),A=function(t){function e(t){var r;return n(this,e),r=s(this,o(e).call(this,t,!0)),function(){var t=this.$root.getAttribute("data-".concat(this.$app.$datasets.state));t&&(this.state=this.state||{},this.state=Object.assign(this.state,JSON.parse(t)))}.call(c(r)),r.$s=function(){var t=this,n=E.call(this,"[data-".concat(this.$app.$datasets.bind,'^="state:"]'));if(n.length>0){var e={};return n.forEach(function(n){var r={};try{var a=m(n.getAttribute("data-".concat(t.$app.$datasets.bind)))}catch(t){}a.forEach(function(t){try{var a=$(t)}catch(t){}try{var o=y(a[1])[1]}catch(t){}r.el=n,e[o]||(e[o]=[]),e[o].push(r)})},this),e}return n.length,null}.call(c(r)),r.connected(),r}return a(e,_),r(e,[{key:"stateWillUpdate",value:function(){}},{key:"stateDidUpdate",value:function(){}},{key:"setState",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,e=arguments.length>1?arguments[1]:void 0;this.stateWillUpdate();var r=[];try{var a=function(e){n[e]!==t.state[e]&&(r.push(e),t.state[e]=n[e],t.$s&&t.$s[e]&&t.$s[e].forEach(function(t){d(t.el,n[e])}))};for(var o in n)a(o)}catch(t){}this.$d.size>0&&g.call(this,r),v(e),this.stateDidUpdate()}}]),e}();t.Component=A,t.Exponent=_,t.Init=function(t){var n=this;return this.components=t.components,this.registeredComponents={},this.$datasets=function(){var n=p;if(t.dataAttributes)for(var e in t.dataAttributes)n[e]=t.dataAttributes[e];return n}(),this._cc=function(e,r){var a=e.getAttribute("data-".concat(n.$datasets.key))||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)});try{n.registeredComponents[a]=new(t.components[e.getAttribute("data-".concat(n.$datasets.component))])({element:e,key:a,app:n})}catch(t){}r&&r()},this._dc=function(t,e){n.registeredComponents[t].disconnecting(),function(){var t=this;try{this.$b.forEach(function(n){n.actions.forEach(function(t){n.el.removeEventListener(t.event,t.handler,t.options)},t)},this)}catch(t){}}.call(n.registeredComponents[t]),delete n.registeredComponents[t],e&&e()},this._rc=function(t,e,r){e.constructor,n.components[t]=e,r&&r()},this._urc=function(t,e){delete n.component[t],e&&e()},u(t.selector.querySelectorAll("[data-".concat(this.$datasets.component,"]"))).forEach(function(t){n._cc(t)},this),t.appCreated&&t.appCreated(),{createComponent:function(t,e){return n._cc(t,e)},deleteComponent:function(t,e){return n._dc(t,e)},register:function(t,e,r){return n._rc(t,e,r)},unregister:function(t,e){return n._urc(t,e)}}},Object.defineProperty(t,"__esModule",{value:!0})});
