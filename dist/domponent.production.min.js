!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t=t||self).Domponent={})}(this,function(t){"use strict";const s={component:"component",key:"key",props:"props",action:"action",state:"state",bind:"bind",ref:"ref",ref_array:"ref-array"},e={INHERITS_FROM:"<-",FROM_COMPONENT:".",KEY_VALUE:":",MULTIPLE_VALUES:"|",METHOD_CALL:"->",LIST:","},n={ONCE:"once",PASSIVE:"passive",CAPTURE:"capture"};class Scope{constructor(t){this.$root=t.element,this.$app=t.app,this.$key=t.key,this.$name=t.element.getAttribute(`data-${this.$app.$datasets.component}`)}}function i(t,s){t.textContent=s}function a(t){return t.trim().split(this.$app.$syntax.KEY_VALUE).map(t=>t.trim())}function o(t){return t.trim().split(this.$app.$syntax.MULTIPLE_VALUES).map(t=>t.trim())}function p(t){return t.trim().split(this.$app.$syntax.FROM_COMPONENT).map(t=>t.trim())}function r(t){this.$d.forEach(s=>{(function(t){this.propsWillUpdate();const s=Object.assign({},this.props);for(let s in this.$p){const e=this.$p[s];t.includes(this.$p[s].parentComponentKey)&&(this.props[s]=e.parentComponent.state[e.parentComponentKey],this.$p[s].els&&this.$p[s].els.forEach(t=>{updateDOM(t,this.props[s])}))}this.propsDidUpdate(s)}).call(this.$app.registeredComponents[s],t)})}function c(t){return[...this.$root.querySelectorAll(t)].filter(t=>t.closest(`[data-${this.$app.$datasets.component}="${this.$root.getAttribute("data-"+this.$app.$datasets.component)}"]`)===this.$root)}class Exponent extends Scope{constructor(t,s=!1){super(t),this.connecting(),this.props={},this.$d=new Set,function(){const t=this;c.call(this,`[data-${this.$app.$datasets.ref}*='${this.$name}${this.$app.$syntax.FROM_COMPONENT}']`).forEach(s=>{this[p.call(t,s.getAttribute(`data-${this.$app.$datasets.ref}`))[1]]=s})}.call(this),function(){let t=null;const s=this;c.call(this,`[data-${this.$app.$datasets.ref_array}*='${this.$name}${this.$app.$syntax.FROM_COMPONENT}']`).forEach(e=>{const n=p.call(s,e.getAttribute(`data-${this.$app.$datasets.ref_array}`))[1];n===t?this[n].push(e):(t=n,this[n]=[],this[n].push(e))})}.call(this),this.$p=function(){const t=this,s=this.$root.getAttribute(`data-${this.$app.$datasets.props}`);if(s){const e={};return o.call(t,s).forEach(s=>{const n=function(t){return t.trim().split(this.$app.$syntax.INHERITS_FROM).map(t=>t.trim())}.call(t,s),i=a.call(t,n[1]),o=n[0],p=this.$app.registeredComponents[i[0]],r=i[1];p.$d.add(this.$key);const h=[...c.call(this,`[${this.$app.$datasets.bind}^="props${this.$app.$syntax.KEY_VALUE}${o}"]`)];this.props[o]=p.state[r],e[o]={parentComponent:p,parentComponentKey:r,els:h.length>0?h:null}},this),e}return null}.call(this),function(){const t=this;this.$b=[],(this.$root.getAttribute(`data-${this.$app.$datasets.action}`)?[this.$root]:[]).concat(c.call(this,`[data-${this.$app.$datasets.action}]`)).forEach(s=>{const e=o.call(t,s.getAttribute(`data-${this.$app.$datasets.action}`)),i={el:s,actions:[]};e.forEach(e=>{const a=function(t){return t.trim().split(this.$app.$syntax.METHOD_CALL).map(t=>t.trim())}.call(t,e),o=a[0],r=p.call(t,a[1]);if(r[0]===this.$name){let e={};if(r[2]){const s=function(t){return t.trim().split(this.$app.$syntax.LIST).map(t=>t.trim())}.call(t,r[2]);for(let t in n)e[n[t]]=s.includes(n[t])}const a=this[r[1]].bind(this);s.addEventListener(o,a,e),i.actions.push({event:o,handler:a,options:e})}},this),this.$b.push(i)},this)}.call(this),!s&&this.connected()}connecting(){}connected(){}disconnecting(){}propsWillUpdate(){}propsDidUpdate(){}}t.Component=class extends Exponent{constructor(t){super(t,!0),function(){const t=this.$root.getAttribute(`data-${this.$app.$datasets.state}`);this.state=t?JSON.parse(t):{}}.call(this),this.$s=function(){const t=this,s=c.call(this,`[data-${this.$app.$datasets.bind}^="state${this.$app.$syntax.KEY_VALUE}"]`);if(s.length>0){const e={};return s.forEach(s=>{const n={};o.call(t,s.getAttribute(`data-${this.$app.$datasets.bind}`)).forEach(i=>{var o=a.call(t,i),r=p.call(t,o[1])[1];n.el=s,e[r]||(e[r]=[]),e[r].push(n)})},this),e}return null}.call(this),this.connected()}stateWillUpdate(){}stateDidUpdate(){}setState(t=this.state,s){this.stateWillUpdate();const e=[];for(let s in t)t[s]!==this.state[s]&&(e.push(s),this.state[s]=t[s],this.$s&&this.$s[s]&&this.$s[s].forEach(e=>{i(e.el,t[s])}));var n;this.$d.size>0&&r.call(this,e),(n=s)&&n(),this.stateDidUpdate()}},t.Exponent=Exponent,t.Init=function(t){return this.components=t.components||{},this.registeredComponents={},this.$datasets=(()=>{const e=s;if(t.dataAttributes)for(let s in t.dataAttributes)e[s]=t.dataAttributes[s];return e})(),this.$syntax=(()=>{const s=e;if(t.customSyntax)for(let e in t.customSyntax)s[e]=t.customSyntax[e];return s})(),this._cc=(s,e)=>{const n=s.getAttribute(`data-${this.$datasets.key}`)||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var s=16*Math.random()|0;return("x"==t?s:3&s|8).toString(16)});this.registeredComponents[n]=new(t.components[s.getAttribute(`data-${this.$datasets.component}`)])({element:s,key:n,app:this}),e&&e()},this._dc=(t,s)=>{this.registeredComponents[t].disconnecting(),function(){this.$b.forEach(t=>{t.actions.forEach(s=>{t.el.removeEventListener(s.event,s.handler,s.options)},this)},this)}.call(this.registeredComponents[t]),delete this.registeredComponents[t],s&&s()},this._rc=(t,s,e)=>{this.components[t]=s,e&&e()},this._urc=(t,s)=>{delete this.component[t],s&&s()},[...t.selector.querySelectorAll(`[data-${this.$datasets.component}]`)].forEach(t=>{this._cc(t)},this),t.appCreated&&t.appCreated(),{createComponent:(t,s)=>this._cc(t,s),deleteComponent:(t,s)=>this._dc(t,s),register:(t,s,e)=>this._rc(t,s,e),unregister:(t,s)=>this._urc(t,s),createdComponents:this.registeredComponents,components:this.components}},Object.defineProperty(t,"__esModule",{value:!0})});
